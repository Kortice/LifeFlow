# LifeFlow ESP32 专注联动硬件使用指南

## 准备工作

### 硬件
- ESP32-S3-N16R8 开发板
- SSD1315 0.96寸 OLED显示屏
- USB数据线

### 软件
- Thonny IDE（用于烧录ESP32程序）
- 支持WebSocket的现代浏览器（如Chrome、Firefox）

## 连接硬件

将OLED显示屏连接到ESP32开发板：
- VCC → 3.3V
- GND → GND
- SCL → GPIO18
- SDA → GPIO17

## 烧录ESP32程序

1. 打开Thonny IDE
2. 连接ESP32开发板到电脑
3. 选择正确的端口和解释器（MicroPython）
4. 将以下文件上传到ESP32根目录：
    都在plan4/esp32s3目录下：
   - `ssd1315.py`（OLED驱动库）
   - `main.py`（主程序，包含专注和休息联动功能）
5. 重启ESP32开发板

## 连接到ESP32的WiFi热点

1. 在运行前端的电脑的WiFi设置中找到名为`LifeFlow-ESP32`的热点
2. 连接到该热点，密码为`12345678`(可能不用)
3. 确保连接成功后，ESP32的IP地址为`192.168.4.1`

## 运行前端应用

1. 确保前端服务已启动（默认运行在 http://localhost:3000）
2. 打开支持WebSocket的现代浏览器访问前端页面
3. 进入专注模块，选择专注时长和休息时长（支持测试选项）

## 专注联动硬件功能说明

### 专注模式
1. 在前端点击"开始"按钮
2. 观察ESP32的OLED显示屏：
   - 显示"专注中"
   - 显示倒计时时间
   - 显示进度条（每秒更新）
3. 前端和OLED的倒计时保持实时同步

### 休息模式
1. 当专注时间结束后，系统自动进入休息模式
2. 或在前端手动触发休息模式
3. 观察ESP32的OLED显示屏：
   - 显示"休息中"
   - 显示休息倒计时时间
   - 显示休息进度条（每秒更新）
4. 前端和OLED的休息倒计时保持实时同步

### 暂停/继续功能
1. 在专注或休息模式下点击"暂停"按钮
2. 观察ESP32的OLED显示屏：
   - 专注模式下显示"已暂停"
   - 休息模式下显示"休息暂停"
3. 点击"继续"按钮恢复计时

### 重置功能
1. 在任意模式下点击"重置"按钮
2. 观察ESP32的OLED显示屏：
   - 清除当前计时状态
   - 显示"准备就绪"
3. 休息计时会立即停止

### 完成状态
1. 当专注时间自然结束：
   - OLED显示"专注完成!"
   - 显示"恭喜你!"
   - 5秒后自动重置为"准备就绪"

2. 当休息时间自然结束：
   - OLED显示"休息完成!"
   - 显示"准备就绪"

## 测试功能

前端专注模块提供了测试选项：
- 专注时长：2分钟（测试）
- 休息时长：1分钟（测试）

这些选项方便用户快速测试整个系统的联动功能，无需等待完整的专注/休息周期。

## 故障排除

### 无法连接到ESP32的WiFi热点
- 确认ESP32开发板已正确烧录程序
- 确认WiFi热点名称和密码正确
- 尝试重启ESP32开发板

### 前端无法连接到ESP32
- 确认已连接到ESP32的WiFi热点
- 确认ESP32的IP地址为`192.168.4.1`
- 确认ESP32的WebSocket服务器正在运行

### OLED显示屏不显示
- 确认OLED显示屏已正确连接到ESP32开发板
- 确认OLED驱动库和程序已正确烧录
- 确认I2C引脚配置正确（SCL=GPIO18，SDA=GPIO17）

### 前端和OLED的倒计时不同步
- 确认前端和ESP32之间的WebSocket连接正常
- 确认前端发送的进度更新消息已被ESP32正确接收

### 休息计时不同步
- 确认`main.py`中已正确实现休息计时功能
- 检查前端是否正确发送休息相关的WebSocket指令

## 注意事项

- ESP32的WiFi热点覆盖范围有限，请确保前端设备在范围内
- 专注和休息模式下，前端页面会每秒钟向ESP32发送一次进度更新
- 当专注或休息时间结束时，OLED显示屏会显示完成信息并在5秒后自动重置
- 如果前端设备断开与ESP32的WiFi连接，ESP32会继续显示倒计时，但不会再接收前端的控制指令
- 重置按钮会立即停止所有计时并恢复到初始状态
- 2分钟测试选项仅用于功能测试，不建议日常使用

## 硬件联动原理

### WebSocket通信
- 前端通过WebSocket与ESP32建立实时连接
- 发送控制指令：开始专注、开始休息、暂停、继续、重置
- 发送进度更新：专注进度、休息进度

### OLED显示逻辑
- 使用SSD1315驱动库控制OLED显示屏
- 显示当前模式（专注/休息）
- 显示剩余时间（分:秒格式）
- 绘制进度条直观展示计时进度
- 根据系统状态显示不同的提示信息

### 状态管理
- 系统状态：准备就绪、专注中、专注暂停、专注完成、休息中、休息暂停、休息完成
- 通过状态变量区分当前是专注模式还是休息模式
- 确保不同模式下的计时逻辑互不干扰

## 更新日志

### V1.0
- 初始版本，支持专注模式的OLED同步显示
- 实现基本的开始、暂停、继续、重置功能

### V1.1
- 新增休息模式的OLED同步显示
- 优化状态管理，区分专注和休息模式
- 支持休息计时的暂停、继续和重置功能
- 添加2分钟测试选项

### V1.2
- 改进进度条显示算法
- 优化WebSocket通信稳定性
- 增强系统状态转换的流畅性
- 完善OLED显示的视觉效果